### 用户、组和权限

用户、组和权限在Linux中是常见的技术，本节主要围绕用户管理（创建用户、删除用户、修改用户信息）、组的管理、针对用户的组设置权限（文件系统级别的权限）

#### Linux安全模型

在IT产品中和安全相关的都会涉及到安全3A，分别对应到认证(Authentication)、授权(Authorization)、审计(Accouting|Audition)

* 认证(Authentication)：认证说的是要验证人的身份是谁，不同人的身份其权力、权限是不同的。在计算中比较普遍的验证方法是基于用户名和密码。

* 授权(Authorization)：授权的意思是当验证完身份后，就需要对不同的人设置不同的权限。如张三能读取文件，李四不能读。张三能对文件读写，李四只能读不能写。

* 审计(Accouting|Audition)：授权完毕后还需要跟踪权限使用。防止权利的滥用，这时候就需要有监督机构去记录时间，用于事后追责。

以上就是与安全相关的3A。本节主要以认证和授权为主。

在Linux中使用认证还是以传统的用户名和密码为主。授权以文件和目录的授权为主。

#### 用户user

在Linux中当用户登陆时，系统会验证身份，一旦身份验证通过，他就会自动的去分配一个令牌(token)，令牌中记录了个人的身份信息(identity)。这个信息主要体现在用户的ID号。

当用户登陆主机时，需要输入正确的用户名和密码。服务器会拿用户输入的用户名密码和本机已存在的用户名信息作比较，如果发现错误登陆失败。如果登陆成功，会发送一个登陆成功的消息，并将令牌(token)发送给用户。令牌内带有一些用户的必要信息(`uid`、`gid`、`gid2`...)。

登陆成功后，当用户需要访问某个文件时，用户就需要将其token发送给此文件，此文件就会根据token信息来判断用户是否有访问次文件的权限。

如果用户登陆后，其token中的信息被修改，如uid被修改，此时用户需要去访问这个新的uid所属的文件时是无法访问的，因为token在用户登陆时就已经发送给用户，token信息虽然被修改，但用户手中的他token依旧是旧的token。除非用户重新登陆，再次获取token，此时的token才是被修改后的新的token。

在Linux中`Username`/`UID`分为以下2种：

* 管理员：root，0
  * 判断用户是否为管理员主要取决于其`uid`是否为0，与其名称是否为`root`无关
* 普通用户：1-60000 自动分配
  * 普通用户`uid`号为1-60000由系统自动分配，其又分为两类：
    * 系统用户(`uid`)：1-499(`CentOS6`)，1-999(`CentOS7`)
      * 对守护进程获取资源进行权限分配
    * 登陆用户(`uid`)：500+(`CentOS6`)，1000+(`CentOS7`)
      * 交互式登陆

> 查看用户ID

```bash
[root@mylinuxops ~]# id -u wang
1000
```

#### 组group

对于一个用户而言可以有多个不同的组，分别称之为用户的基本组(主组)和附加组；基本组组名和用户名相同，且仅包含一个户用，也叫四有组。基本组以外的组属于用户的附加组(额外组)

Linux中`Groupname`/`GID`也分为两种：

* 管理员组：root，0
  * 需要注意，普通用户加入了root组并不等于其拥有了root权限，只是代表了其对某些文件具有了操作的权限。
* 普通组：1-65535
  * 普通组又分为系统组和非系统组，我们通常把非系统组叫做普通组
    * 系统组：1-499(`CentOS6`)，1-999(`CentOS7`)
    * 非系统组：00+(`CentOS6`)，1000+(`CentOS7`)

